<!doctype html>
<html lang="fi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Kotity√∂arpa</title>

<style>
:root{
  --bg1:#ffd6e8; --bg2:#ffc1dd;
  --card:#ffffffcc; --card2:#ffffffb3;
  --text:#1f2937; --muted:#6b7280;
  --border:rgba(31,41,55,.12);
  --shadow:0 10px 28px rgba(0,0,0,.12);
  --blue:#3b82f6; --blue2:#2563eb;
  --slate:#334155; --radius:18px;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  color:var(--text);
  background:linear-gradient(180deg,var(--bg1),var(--bg2));
}
.wrap{max-width:980px;margin:auto;padding:16px}
header{display:flex;gap:10px;align-items:center}
.panel{
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:16px;
}
.gridPick{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:10px;
}
.pickRow{
  display:flex;
  gap:8px;
  align-items:center;
  background:#fff;
  border:1px solid var(--border);
  border-radius:14px;
  padding:8px 10px;
  font-weight:800;
}
.pickerTop{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:8px;
}
.pickerBtns{display:flex;gap:8px}
.miniBtn{
  padding:6px 10px;
  border-radius:10px;
  border:1px solid var(--border);
  background:#11182710;
  font-weight:800;
  cursor:pointer;
}
.buttons{display:flex;gap:10px;margin-top:14px}
button{
  border:0;
  border-radius:14px;
  padding:11px 14px;
  font-weight:900;
  cursor:pointer;
}
.primary{background:linear-gradient(180deg,var(--blue),var(--blue2));color:#fff}
.secondary{background:#11182710}
.ghost{background:var(--slate);color:#fff}

.resultsWrap{margin-top:16px;display:none}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:12px;
}
.taskCard{
  background:var(--card2);
  border-radius:var(--radius);
  padding:14px;
  box-shadow:var(--shadow);
}
.taskHeader{
  display:flex;
  justify-content:space-between;
  font-weight:900;
  margin-bottom:8px;
}
.person{
  background:#fff;
  border-radius:12px;
  padding:8px 10px;
  margin-top:6px;
  font-weight:800;
}
.msg{margin-top:10px}
.error{background:#fee2e2;padding:10px;border-radius:12px}

@media(max-width:520px){
  .buttons{flex-direction:column}
  .pickerBtns{flex-direction:column}
}
</style>
</head>

<body>
<div class="wrap">

<header>
  <div style="font-size:26px">üè†</div>
  <h1>Kotity√∂arpa</h1>
</header>

<div class="panel">

  <!-- TASKS -->
  <div class="pickerTop">
    <h3>Arvottavat kotity√∂t</h3>
    <div class="pickerBtns">
      <button class="miniBtn" id="taskAllBtn">Valitse kaikki</button>
      <button class="miniBtn" id="taskNoneBtn">Tyhjenn√§</button>
    </div>
  </div>
  <div class="gridPick" id="taskGrid"></div>

  <!-- PEOPLE -->
  <div class="pickerTop" style="margin-top:14px">
    <h3>Arvonnassa mukana</h3>
    <div class="pickerBtns">
      <button class="miniBtn" id="peopleAllBtn">Valitse kaikki</button>
      <button class="miniBtn" id="peopleNoneBtn">Tyhjenn√§</button>
    </div>
  </div>
  <div class="gridPick" id="peopleGrid"></div>

  <div class="buttons">
    <button class="primary" id="drawBtn">Arvo!</button>
    <button class="secondary" id="copyBtn" disabled>Kopioi tulos</button>
  </div>

  <div class="msg" id="msg"></div>
</div>

<div class="resultsWrap" id="resultsWrap">
  <h2>Tulos</h2>
  <div class="grid" id="results"></div>
  <div class="buttons">
    <button class="ghost" id="rerollBtn">Arvo uudelleen</button>
  </div>
</div>

</div>

<script>
(() => {

const PEOPLE=["√Ñiti","Isk√§","Jaan","Elina","Hilma","Pentti","Olli","Oiva","Tiina","Sanni","Elide","Adelle","Topi","Ossi","Miia","Annika","Lauri","Jose","Make"];
const TASKS=[
"Tiskikoneen tyhjennys","Tiskikoneen t√§ytt√§minen","Keitti√∂n siivous",
"P√∂yd√§nkattaminen","Ruuanlaitto","Lelujen ker√§√§minen","Koiran hoito",
"Imurointi","Kaupassa k√§ynti","Vessan siivous","Kierr√§tysen vienti",
"P√∂yd√§n tyhjennys","Pelin siivous","Olohuoneen siivous","Eteisen siivous",
"Kodinhoitohuoneen siivous","Aulan siivous","Lumity√∂t",
"Pesuhuoneen/saunan siivous","Pyykkihuolto","Pelivuoro", "Keitti√∂n lattian siivous"
];

const TOYS="Lelujen ker√§√§minen";
const KITCHEN="Keitti√∂n siivous";

const ONLY_ALLOWED={ "Adelle":[TOYS], "Elide":[TOYS,KITCHEN] };
const DISALLOWED={ "√Ñiti":[TOYS], "Isk√§":[TOYS] };
const NEEDS_HELPER=new Set(["Hilma","Pentti","Adelle","Elide"]);

const taskGrid=document.getElementById("taskGrid");
const peopleGrid=document.getElementById("peopleGrid");
const resultsEl=document.getElementById("results");
const resultsWrap=document.getElementById("resultsWrap");
const msgEl=document.getElementById("msg");
const copyBtn=document.getElementById("copyBtn");

function render(){
  TASKS.forEach(t=>taskGrid.innerHTML+=`<label class="pickRow"><input type="checkbox" value="${t}"> ${t}</label>`);
  PEOPLE.forEach(p=>peopleGrid.innerHTML+=`<label class="pickRow"><input type="checkbox" value="${p}" checked> ${p}</label>`);
}

function allowed(p,t){
  if(ONLY_ALLOWED[p] && !ONLY_ALLOWED[p].includes(t)) return false;
  if(DISALLOWED[p] && DISALLOWED[p].includes(t)) return false;
  return true;
}

function draw(){
  msgEl.innerHTML="";
  resultsEl.innerHTML="";
  const tasks=[...taskGrid.querySelectorAll("input:checked")].map(i=>i.value);
  const people=[...peopleGrid.querySelectorAll("input:checked")].map(i=>i.value);

  let remaining=new Set(people);
  let map=new Map();

  for(const task of tasks){
    let eligible=[...remaining].filter(p=>allowed(p,task));
    if(!eligible.length){
      msgEl.innerHTML=`<div class="error">Ei tekij√§√§: ${task}</div>`;
      return;
    }
    let chosen=eligible[Math.floor(Math.random()*eligible.length)];
    map.set(task,[chosen]);
    remaining.delete(chosen);

    if(task===TOYS && (chosen==="Elide"||chosen==="Adelle")){
      const other=chosen==="Elide"?"Adelle":"Elide";
      if(remaining.has(other)){
        map.get(task).push(other);
        remaining.delete(other);
      }
    }

    if(NEEDS_HELPER.has(chosen)){
      const helper=[...remaining].find(p=>allowed(p,task));
      if(helper){
        map.get(task).push(helper);
        remaining.delete(helper);
      }
    }
  }

  map.forEach((ppl,task)=>{
    resultsEl.innerHTML+=`
      <div class="taskCard">
        <div class="taskHeader">${task}<span>${ppl.length} hl√∂</span></div>
        ${ppl.map(p=>`<div class="person">${p}</div>`).join("")}
      </div>`;
  });

  resultsWrap.style.display="block";
  copyBtn.disabled=false;
}

document.getElementById("drawBtn").onclick=draw;
document.getElementById("rerollBtn").onclick=draw;

document.getElementById("taskAllBtn").onclick=()=>taskGrid.querySelectorAll("input").forEach(i=>i.checked=true);
document.getElementById("taskNoneBtn").onclick=()=>taskGrid.querySelectorAll("input").forEach(i=>i.checked=false);
document.getElementById("peopleAllBtn").onclick=()=>peopleGrid.querySelectorAll("input").forEach(i=>i.checked=true);
document.getElementById("peopleNoneBtn").onclick=()=>peopleGrid.querySelectorAll("input").forEach(i=>i.checked=false);

copyBtn.onclick=()=>{
  let text="";
  document.querySelectorAll(".taskCard").forEach(c=>{
    text+=c.innerText+"\n";
  });
  navigator.clipboard.writeText(text);
};

render();
})();
</script>
</body>
</html>
